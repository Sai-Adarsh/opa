<!doctype html><html lang=en><head><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-84550302-1','auto');ga('send','pageview');</script><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=description content="Policy-based control for cloud native environments"><meta property=og:title content="How Do I Test Policies?"><meta property=og:type content=documentation><meta property=og:url content=https://openpolicyagent.org/docs/v0.10.7/how-do-i-test-policies/><meta property=og:locale content=en_US><meta property=og:site_name content="Open Policy Agent"><meta property=og:description content="Policy-based control for cloud native environments"><meta name=og:type content=article><meta name=og:image content=https://openpolicyagent.org/img/logos/opa-horizontal-color.png><meta name=og:image:alt content="Open Policy Agent project logo"><meta name=og:image:type content=image/png><meta name=twitter:card content=summary><meta name=twitter:site content=@OpenPolicyAgent><meta name=twitter:creator content=@OpenPolicyAgent><link rel=canonical content=https://openpolicyagent.org/docs/v0.10.7/how-do-i-test-policies/><link rel="shortcut icon" href=/favicon.png type=image/x-icon><meta name=generator content="Hugo 0.53"><title>Open Policy Agent | How Do I Test Policies?</title><link rel=stylesheet href=/css/style.6bbca25e01250b8412df90aabdfbddb4f7b3b892dd593d933cd29794b98a3373.css integrity="sha256-a7yiXgElC4QS35CqvfvdtPezuJLdWT2TPNKXlLmKM3M="></head><body><div class=dashboard><div class="dashboard-panel left has-background-white-bis is-hidden-mobile"><div class="dashboard-panel-header has-text-centered"><div class=dashboard-panel-header-logo><a href=https://openpolicyagent.org><img src=/img/logos/opa-stacked-color.png></a></div><div class="dropdown is-left"><div class=dropdown-trigger><span class="button is-primary"><span><strong>v0.10.7</strong>
<span class="tag latest-tag is-success is-small has-text-weight-bold">latest</span></span></span></div></div></div><div class="dashboard-panel-content is-scrollable"><div class=docs-nav><span class=docs-nav-title>Documentation</span>
<a class=docs-nav-item href=/docs/v0.10.7/>Introduction</a>
<a class=docs-nav-item href=/docs/v0.10.7/how-does-opa-work/>How Does OPA Work?</a>
<a class=docs-nav-item href=/docs/v0.10.7/how-do-i-write-policies/>How Do I Write Policies?</a>
<a class="docs-nav-item is-active" href=/docs/v0.10.7/how-do-i-test-policies/>How Do I Test Policies?</a><div class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#getting-started>Getting Started</a></li><li><a href=#test-format>Test Format</a></li><li><a href=#test-discovery>Test Discovery</a></li><li><a href=#test-results>Test Results</a></li><li><a href=#data-mocking>Data Mocking</a></li><li><a href=#coverage>Coverage</a></li><li><a href=#profiling>Profiling</a><ul><li><a href=#sort-criteria-for-the-profile-results>Sort criteria for the profile results</a></li><li><a href=#example-policy>Example Policy</a></li><li><a href=#example-display-all-profile-results-with-default-ordering-criteria>Example: Display <code>ALL</code> profile results with <code>default</code> ordering criteria</a><ul><li><a href=#example-display-top-5-profile-results>Example: Display top <code>5</code> profile results</a></li><li><a href=#example-display-top-5-profile-results-based-on-the-number-of-times-an-expression-is-evaluated>Example: Display top <code>5</code> profile results based on the <code>number of times an expression is evaluated</code></a></li><li><a href=#example-display-top-5-profile-results-based-on-the-number-of-times-an-expression-is-evaluated-and-number-of-times-an-expression-is-re-evaluated>Example: Display top <code>5</code> profile results based on the <code>number of times an expression is evaluated</code> and <code>number of times an expression is re-evaluated</code></a></li></ul></li></ul></li></ul></li></ul></nav></div><a class=docs-nav-item href=/docs/v0.10.7/language-reference/>Language Reference</a>
<a class=docs-nav-item href=/docs/v0.10.7/configuration/>Configuration Reference</a>
<a class=docs-nav-item href=/docs/v0.10.7/rest-api/>REST API</a>
<a class=docs-nav-item href=/docs/v0.10.7/deployments/>Deployments</a>
<a class=docs-nav-item href=/docs/v0.10.7/bundles/>Bundles</a>
<a class=docs-nav-item href=/docs/v0.10.7/status/>Status</a>
<a class=docs-nav-item href=/docs/v0.10.7/decision-logs/>Decision Logs</a>
<a class=docs-nav-item href=/docs/v0.10.7/monitoring/>Monitoring</a>
<a class=docs-nav-item href=/docs/v0.10.7/discovery/>Discovery</a>
<a class=docs-nav-item href=/docs/v0.10.7/security/>Security</a>
<a class=docs-nav-item href=/docs/v0.10.7/plugins/>Plugins</a>
<a class=docs-nav-item href=/docs/v0.10.7/comparison-to-other-systems/>Comparison to Other Systems</a>
<a class=docs-nav-item href=/docs/v0.10.7/faq/>FAQ</a>
<a class=docs-nav-item href=/docs/v0.10.7/rego-cheatsheet/>Rego Cheatsheet</a><hr class=docs-nav-hr><span class=docs-nav-title>Tutorials</span>
<a class=docs-nav-item href=/docs/v0.10.7/get-started/>Get started</a>
<a class=docs-nav-item href=/docs/v0.10.7/docker-authorization/>Docker Authorization</a>
<a class=docs-nav-item href=/docs/v0.10.7/http-api-authorization/>HTTP API Authorization</a>
<a class=docs-nav-item href=/docs/v0.10.7/ssh-and-sudo-authorization/>SSH and sudo Authorization</a>
<a class=docs-nav-item href=/docs/v0.10.7/kafka-authorization/>Kafka Authorization</a>
<a class=docs-nav-item href=/docs/v0.10.7/kubernetes-admission-control/>Kubernetes Admission Control</a>
<a class=docs-nav-item href=/docs/v0.10.7/terraform/>Terraform Testing</a>
<a class=docs-nav-item href=/docs/v0.10.7/ceph-authorization/>Ceph Authorization</a><hr class=docs-nav-hr><span class=docs-nav-title>Guides</span>
<a class=docs-nav-item href=/docs/v0.10.7/guides-identity/>Identity and User Attributes</a>
<a class=docs-nav-item href=/docs/v0.10.7/guides-kubernetes-admission-control/>Kubernetes Admission Control</a></div></div></div><div class="dashboard-main is-scrollable"><nav class="navbar is-primary"><div class="navbar-brand is-hidden-tablet"><a class=navbar-item href=https://openpolicyagent.org><img src=/img/logos/opa-icon-white.png></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=mobile-menu><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div class="navbar-menu is-hidden-tablet" id=mobile-menu><div class=navbar-start><span class="navbar-item is-size-5 has-text-weight-light is-uppercase">Documentation</span>
<a class=navbar-item href=/docs/v0.10.7/>Introduction</a>
<a class=navbar-item href=/docs/v0.10.7/how-does-opa-work/>How Does OPA Work?</a>
<a class=navbar-item href=/docs/v0.10.7/how-do-i-write-policies/>How Do I Write Policies?</a>
<a class=navbar-item href=/docs/v0.10.7/how-do-i-test-policies/>How Do I Test Policies?</a>
<a class=navbar-item href=/docs/v0.10.7/language-reference/>Language Reference</a>
<a class=navbar-item href=/docs/v0.10.7/configuration/>Configuration Reference</a>
<a class=navbar-item href=/docs/v0.10.7/rest-api/>REST API</a>
<a class=navbar-item href=/docs/v0.10.7/deployments/>Deployments</a>
<a class=navbar-item href=/docs/v0.10.7/bundles/>Bundles</a>
<a class=navbar-item href=/docs/v0.10.7/status/>Status</a>
<a class=navbar-item href=/docs/v0.10.7/decision-logs/>Decision Logs</a>
<a class=navbar-item href=/docs/v0.10.7/monitoring/>Monitoring</a>
<a class=navbar-item href=/docs/v0.10.7/discovery/>Discovery</a>
<a class=navbar-item href=/docs/v0.10.7/security/>Security</a>
<a class=navbar-item href=/docs/v0.10.7/plugins/>Plugins (Experimental)</a>
<a class=navbar-item href=/docs/v0.10.7/comparison-to-other-systems/>Comparison to Other Systems</a>
<a class=navbar-item href=/docs/v0.10.7/faq/>Frequently Asked Questions</a>
<a class=navbar-item href=/docs/v0.10.7/rego-cheatsheet/>Rego Cheatsheet</a><br><span class="navbar-item is-size-5 has-text-weight-light is-uppercase">Tutorials</span>
<a class=navbar-item href=/docs/v0.10.7/get-started/>Get started</a>
<a class=navbar-item href=/docs/v0.10.7/docker-authorization/>Docker Authorization</a>
<a class=navbar-item href=/docs/v0.10.7/http-api-authorization/>HTTP API Authorization</a>
<a class=navbar-item href=/docs/v0.10.7/ssh-and-sudo-authorization/>SSH and sudo Authorization</a>
<a class=navbar-item href=/docs/v0.10.7/kafka-authorization/>Kafka Authorization</a>
<a class=navbar-item href=/docs/v0.10.7/kubernetes-admission-control/>Kubernetes Admission Control</a>
<a class=navbar-item href=/docs/v0.10.7/terraform/>Terraform Testing</a>
<a class=navbar-item href=/docs/v0.10.7/ceph-authorization/>Ceph Authorization</a><br><span class="navbar-item is-size-5 has-text-weight-light is-uppercase">Guides</span>
<a class=navbar-item href=/docs/v0.10.7/guides-identity/>Guides: Identity and User Attributes</a>
<a class=navbar-item href=/docs/v0.10.7/guides-kubernetes-admission-control/>Guides: Kubernetes Admission Control</a></div><div class=navbar-end><div class=navbar-item><div class=buttons><a class="button is-primary" href=https://github.com/open-policy-agent/opa target=_blank><span class="icon has-text-white-bis"><i class="fab fa-github"></i></span></a><a class="button is-primary" href=https://twitter.com/OpenPolicyAgent target=_blank><span class="icon has-text-white-bis"><i class="fab fa-twitter"></i></span></a><a class="button is-primary" href=https://blog.openpolicyagent.org target=_blank><span class="icon has-text-white-bis"><i class="fab fa-medium"></i></span></a><a class="button is-primary" href=https://slack.openpolicyagent.org target=_blank><span class="icon has-text-white-bis"><i class="fab fa-slack"></i></span></a></div></div></div></div><div class=navbar-menu><div class=navbar-end><a class=navbar-item href=https://github.com/open-policy-agent/opa target=_blank><span class="icon has-text-white-bis"><i class="fab fa-github"></i></span></a><a class=navbar-item href=https://twitter.com/OpenPolicyAgent target=_blank><span class="icon has-text-white-bis"><i class="fab fa-twitter"></i></span></a><a class=navbar-item href=https://blog.openpolicyagent.org target=_blank><span class="icon has-text-white-bis"><i class="fab fa-medium"></i></span></a><a class=navbar-item href=https://slack.openpolicyagent.org target=_blank><span class="icon has-text-white-bis"><i class="fab fa-slack"></i></span></a></div></div></nav><article class=article><div class=container><section class=hero><div class=hero-body><p class="title is-size-1 is-size-2-mobile">How Do I Test Policies?</p></div></section><section class=section><div class=content><p>OPA gives you a high-level declarative language
(<a href=../how-do-i-write-policies>Rego</a>) to author fine-grained policies that
codify important requirements in your system.</p><p>To help you verify the correctness of your policies, OPA also gives you a
framework that you can use to write <em>tests</em> for your policies. By writing
tests for your policies you can speed up the development process of new rules
and reduce the amount of time it takes to modify rules as requirements evolve.</p><h2 id=getting-started>Getting Started</h2><p>Let&rsquo;s use an example to get started. The file below implements a simple
policy that allows new users to be created and users to access their own
profile.</p><p><strong>example.rego</strong>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#000>package</span> <span style=color:#000>authz</span>

<span style=color:#000>allow</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>input</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>path</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;users&#34;</span><span style=color:#ce5c00;font-weight:700>]</span>
    <span style=color:#000>input</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>method</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;POST&#34;</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#000>allow</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>input</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>path</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;users&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>profile_id</span><span style=color:#ce5c00;font-weight:700>]</span>
    <span style=color:#000>input</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>method</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;GET&#34;</span>
    <span style=color:#000>profile_id</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>input</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>user_id</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>To test this policy, we will create a separate Rego file that contains test cases.</p><p><strong>example_test.rego</strong>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#000>package</span> <span style=color:#000>authz</span>

<span style=color:#000>test_post_allowed</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>allow</span> <span style=color:#000>with</span> <span style=color:#000>input</span> <span style=color:#000>as</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;path&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;users&#34;</span><span style=color:#ce5c00;font-weight:700>]</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;method&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;POST&#34;</span><span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#000>test_get_anonymous_denied</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>not</span> <span style=color:#000>allow</span> <span style=color:#000>with</span> <span style=color:#000>input</span> <span style=color:#000>as</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;path&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;users&#34;</span><span style=color:#ce5c00;font-weight:700>]</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;method&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;GET&#34;</span><span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#000>test_get_user_allowed</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>allow</span> <span style=color:#000>with</span> <span style=color:#000>input</span> <span style=color:#000>as</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;path&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;users&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;bob&#34;</span><span style=color:#ce5c00;font-weight:700>]</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;method&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;GET&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;user_id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;bob&#34;</span><span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#000>test_get_another_user_denied</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>not</span> <span style=color:#000>allow</span> <span style=color:#000>with</span> <span style=color:#000>input</span> <span style=color:#000>as</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;path&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;users&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;bob&#34;</span><span style=color:#ce5c00;font-weight:700>]</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;method&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;GET&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;user_id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;alice&#34;</span><span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>Both of these files are saved in the same directory.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ls
example.rego      example_test.rego</code></pre></div><p>To exercise the policy, run the <code>opa test</code> command in the directory containing the files.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ opa <span style=color:#204a87>test</span> . -v
data.authz.test_post_allowed: PASS <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span>.417µs<span style=color:#ce5c00;font-weight:700>)</span>
data.authz.test_get_anonymous_denied: PASS <span style=color:#ce5c00;font-weight:700>(</span>426ns<span style=color:#ce5c00;font-weight:700>)</span>
data.authz.test_get_user_allowed: PASS <span style=color:#ce5c00;font-weight:700>(</span>367ns<span style=color:#ce5c00;font-weight:700>)</span>
data.authz.test_get_another_user_denied: PASS <span style=color:#ce5c00;font-weight:700>(</span>320ns<span style=color:#ce5c00;font-weight:700>)</span>
--------------------------------------------------------------------------------
PASS: <span style=color:#0000cf;font-weight:700>4</span>/4</code></pre></div><p>The <code>opa test</code> output indicates that all of the tests passed.</p><p>Try exercising the tests a bit more by removing the first rule in <strong>example.rego</strong>.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ opa <span style=color:#204a87>test</span> . -v
data.authz.test_post_allowed: FAIL <span style=color:#ce5c00;font-weight:700>(</span>607ns<span style=color:#ce5c00;font-weight:700>)</span>
data.authz.test_get_anonymous_denied: PASS <span style=color:#ce5c00;font-weight:700>(</span>288ns<span style=color:#ce5c00;font-weight:700>)</span>
data.authz.test_get_user_allowed: PASS <span style=color:#ce5c00;font-weight:700>(</span>346ns<span style=color:#ce5c00;font-weight:700>)</span>
data.authz.test_get_another_user_denied: PASS <span style=color:#ce5c00;font-weight:700>(</span>365ns<span style=color:#ce5c00;font-weight:700>)</span>
--------------------------------------------------------------------------------
PASS: <span style=color:#0000cf;font-weight:700>3</span>/4
FAIL: <span style=color:#0000cf;font-weight:700>1</span>/4</code></pre></div><h2 id=test-format>Test Format</h2><p>Tests are expressed as standard Rego rules with a convention that the rule
name is prefixed with <code>test_</code>.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#000>package</span> <span style=color:#000>mypackage</span>

<span style=color:#000>test_some_descriptive_name</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#8f5902;font-style:italic># test logic</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><h2 id=test-discovery>Test Discovery</h2><p>The <code>opa test</code> subcommand runs all of the tests (i.e., rules prefixed with
<code>test_</code>) found in Rego files passed on the command line. If directories are
passed as command line arguments, <code>opa test</code> will load their file contents
recursively.</p><h2 id=test-results>Test Results</h2><p>If the test rule is undefined or generates a non-<code>true</code> value the test result
is reported as <code>FAIL</code>. If the test encounters a runtime error (e.g., a divide
by zero condition) the test result is marked as an <code>ERROR</code>. Otherwise, the
test result is marked as <code>PASS</code>.</p><p><strong>pass_fail_error_test.rego</strong>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#000>package</span> <span style=color:#000>example</span>

<span style=color:#8f5902;font-style:italic># This test will pass.</span>
<span style=color:#000>test_ok</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>true</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#8f5902;font-style:italic># This test will fail.</span>
<span style=color:#000>test_failure</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>2</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#8f5902;font-style:italic># This test will error.</span>
<span style=color:#000>test_error</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#0000cf;font-weight:700>0</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>By default, <code>opa test</code> reports the number of tests executed and displays all
of the tests that failed or errored.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ opa <span style=color:#204a87>test</span> pass_fail_error_test.rego
data.example.test_failure: FAIL <span style=color:#ce5c00;font-weight:700>(</span>253ns<span style=color:#ce5c00;font-weight:700>)</span>
data.example.test_error: ERROR <span style=color:#ce5c00;font-weight:700>(</span>289ns<span style=color:#ce5c00;font-weight:700>)</span>
  pass_fail_error_test.rego:15: eval_internal_error: div: divide by zero
--------------------------------------------------------------------------------
PASS: <span style=color:#0000cf;font-weight:700>1</span>/3
FAIL: <span style=color:#0000cf;font-weight:700>1</span>/3
ERROR: <span style=color:#0000cf;font-weight:700>1</span>/3</code></pre></div><p>By default, OPA prints the test results in a human-readable format. If you
need to consume the test results programmatically, use the JSON output format.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ opa <span style=color:#204a87>test</span> --format<span style=color:#ce5c00;font-weight:700>=</span>json pass_fail_error_test.rego</code></pre></div><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>[</span>
  <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>&#34;location&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;file&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;pass_fail_error_test.rego&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;row&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;col&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>1</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#204a87;font-weight:700>&#34;package&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;data.example&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;test_ok&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;duration&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>618515</span>
  <span style=color:#000;font-weight:700>},</span>
  <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>&#34;location&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;file&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;pass_fail_error_test.rego&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;row&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>9</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;col&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>1</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#204a87;font-weight:700>&#34;package&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;data.example&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;test_failure&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;fail&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;duration&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>322177</span>
  <span style=color:#000;font-weight:700>},</span>
  <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>&#34;location&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;file&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;pass_fail_error_test.rego&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;row&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>14</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;col&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>1</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#204a87;font-weight:700>&#34;package&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;data.example&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;test_error&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;error&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;code&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;eval_internal_error&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;message&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;div: divide by zero&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;location&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>&#34;file&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;pass_fail_error_test.rego&#34;</span><span style=color:#000;font-weight:700>,</span>
        <span style=color:#204a87;font-weight:700>&#34;row&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>,</span>
        <span style=color:#204a87;font-weight:700>&#34;col&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>5</span>
      <span style=color:#000;font-weight:700>}</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#204a87;font-weight:700>&#34;duration&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>345148</span>
  <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>]</span></code></pre></div><h2 id=data-mocking>Data Mocking</h2><p>OPA&rsquo;s <code>with</code> keyword can be used to replace the data document. Both base and virtual documents can be replaced. Below is a simple policy that depends on the data document.</p><p><strong>authz.rego</strong>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#000>package</span> <span style=color:#000>authz</span>

<span style=color:#000>allow</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>x</span> <span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>policies</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>_</span><span style=color:#ce5c00;font-weight:700>]</span>
    <span style=color:#000>x</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;test_policy&#34;</span>
    <span style=color:#000>matches_role</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>input</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>role</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#000>matches_role</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>my_role</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>roles</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>my_role</span><span style=color:#ce5c00;font-weight:700>][</span><span style=color:#000>_</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>input</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>user</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>Below is the Rego file to test the above policy.</p><p><strong>authz_test.rego</strong>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#000>package</span> <span style=color:#000>authz</span>

<span style=color:#000>policies</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;test_policy&#34;</span><span style=color:#000;font-weight:700>}</span><span style=color:#ce5c00;font-weight:700>]</span>
<span style=color:#000>roles</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;admin&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;alice&#34;</span><span style=color:#ce5c00;font-weight:700>]</span><span style=color:#000;font-weight:700>}</span>

<span style=color:#000>test_allow_with_data</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>allow</span> <span style=color:#000>with</span> <span style=color:#000>input</span> <span style=color:#000>as</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;user&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;alice&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;role&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;admin&#34;</span><span style=color:#000;font-weight:700>}</span>  <span style=color:#000>with</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>policies</span> <span style=color:#000>as</span> <span style=color:#000>policies</span>  <span style=color:#000>with</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>roles</span> <span style=color:#000>as</span> <span style=color:#000>roles</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>To exercise the policy, run the <code>opa test</code> command.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ opa <span style=color:#204a87>test</span> -v authz.rego authz_test.rego
data.authz.test_allow_with_data: PASS <span style=color:#ce5c00;font-weight:700>(</span>697ns<span style=color:#ce5c00;font-weight:700>)</span>
--------------------------------------------------------------------------------
PASS: <span style=color:#0000cf;font-weight:700>1</span>/1</code></pre></div><p>Below is an example to replace a rule without arguments.</p><p><strong>authz.rego</strong>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#000>package</span> <span style=color:#000>authz</span>

<span style=color:#000>allow1</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>allow2</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#000>allow2</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>1</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p><strong>authz_test.rego</strong>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#000>package</span> <span style=color:#000>authz</span>

<span style=color:#000>test_replace_rule</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>allow1</span> <span style=color:#000>with</span> <span style=color:#000>allow2</span> <span style=color:#000>as</span> <span style=color:#204a87;font-weight:700>true</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$  opa <span style=color:#204a87>test</span> -v authz.rego authz_test.rego
data.authz.test_replace_rule: PASS <span style=color:#ce5c00;font-weight:700>(</span>328ns<span style=color:#ce5c00;font-weight:700>)</span>
--------------------------------------------------------------------------------
PASS: <span style=color:#0000cf;font-weight:700>1</span>/1</code></pre></div><p>Functions with arguments cannot be replaced by the <code>with</code> keyword. For example, in the below policy the function <code>cannot_replace</code> cannot be replaced.</p><p><strong>authz.rego</strong>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#000>package</span> <span style=color:#000>authz</span>

<span style=color:#000>invalid_replace</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>cannot_replace</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>input</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>label</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#000>cannot_replace</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>label</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;test_label&#34;</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p><strong>authz_test.rego</strong>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#000>package</span> <span style=color:#000>authz</span>

<span style=color:#000>test_invalid_replace</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>invalid_replace</span> <span style=color:#000>with</span> <span style=color:#000>input</span> <span style=color:#000>as</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;label&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;test_label&#34;</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000>with</span> <span style=color:#000>cannot_replace</span> <span style=color:#000>as</span> <span style=color:#204a87;font-weight:700>true</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ opa <span style=color:#204a87>test</span> -v authz.rego authz_test.rego
<span style=color:#0000cf;font-weight:700>1</span> error occurred: authz_test.rego:4: rego_compile_error: with keyword cannot replace rules with arguments</code></pre></div><h2 id=coverage>Coverage</h2><p>In addition to reporting pass, fail, and error results for tests, <code>opa test</code>
can also report <em>coverage</em> for the policies under test.</p><p>The coverage report includes all of the lines evaluated and not evaluated in
the Rego files provided on the command line. When a line is not covered it
indicates one of two things:</p><ul><li>If the line refers to the head of a rule, the body of the rule was never true.</li><li>If the line refers to an expression in a rule, the expression was never evaluated.</li></ul><p>If we run the coverage report on the original <strong>example.rego</strong> file without
<code>test_get_user_allowed</code> from <strong>example_test</strong>.rego the report will indicate
that line 8 is not covered.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>opa <span style=color:#204a87>test</span> --coverage --format<span style=color:#ce5c00;font-weight:700>=</span>json example.rego example_test.rego</code></pre></div><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>&#34;files&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>&#34;example.rego&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;covered&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
        <span style=color:#000;font-weight:700>{</span>
          <span style=color:#204a87;font-weight:700>&#34;start&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#204a87;font-weight:700>&#34;row&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>3</span>
          <span style=color:#000;font-weight:700>},</span>
          <span style=color:#204a87;font-weight:700>&#34;end&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#204a87;font-weight:700>&#34;row&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>5</span>
          <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000;font-weight:700>},</span>
        <span style=color:#000;font-weight:700>{</span>
          <span style=color:#204a87;font-weight:700>&#34;start&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#204a87;font-weight:700>&#34;row&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>9</span>
          <span style=color:#000;font-weight:700>},</span>
          <span style=color:#204a87;font-weight:700>&#34;end&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#204a87;font-weight:700>&#34;row&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>11</span>
          <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000;font-weight:700>}</span>
      <span style=color:#000;font-weight:700>],</span>
      <span style=color:#204a87;font-weight:700>&#34;not_covered&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
        <span style=color:#000;font-weight:700>{</span>
          <span style=color:#204a87;font-weight:700>&#34;start&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#204a87;font-weight:700>&#34;row&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>8</span>
          <span style=color:#000;font-weight:700>},</span>
          <span style=color:#204a87;font-weight:700>&#34;end&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#204a87;font-weight:700>&#34;row&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>8</span>
          <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000;font-weight:700>}</span>
      <span style=color:#000;font-weight:700>]</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#204a87;font-weight:700>&#34;example_test.rego&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;covered&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
        <span style=color:#000;font-weight:700>{</span>
          <span style=color:#204a87;font-weight:700>&#34;start&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#204a87;font-weight:700>&#34;row&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>3</span>
          <span style=color:#000;font-weight:700>},</span>
          <span style=color:#204a87;font-weight:700>&#34;end&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#204a87;font-weight:700>&#34;row&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>4</span>
          <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000;font-weight:700>},</span>
        <span style=color:#000;font-weight:700>{</span>
          <span style=color:#204a87;font-weight:700>&#34;start&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#204a87;font-weight:700>&#34;row&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>7</span>
          <span style=color:#000;font-weight:700>},</span>
          <span style=color:#204a87;font-weight:700>&#34;end&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#204a87;font-weight:700>&#34;row&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>8</span>
          <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000;font-weight:700>},</span>
        <span style=color:#000;font-weight:700>{</span>
          <span style=color:#204a87;font-weight:700>&#34;start&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#204a87;font-weight:700>&#34;row&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>11</span>
          <span style=color:#000;font-weight:700>},</span>
          <span style=color:#204a87;font-weight:700>&#34;end&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#204a87;font-weight:700>&#34;row&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>12</span>
          <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000;font-weight:700>}</span>
      <span style=color:#000;font-weight:700>]</span>
    <span style=color:#000;font-weight:700>}</span>
  <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><h2 id=profiling>Profiling</h2><p>In addition to testing and coverage reporting, you can also <em>profile</em> your
policies using <code>opa eval</code>. The profiler is useful if you need to understand
why policy evaluation is slow.</p><p>The <code>opa eval</code> command provides the following profiler options:</p><table><thead><tr><th>Option</th><th>Detail</th><th>Default</th></tr></thead><tbody><tr><td><span class=opa-keep-it-together><code>--profile</code></span></td><td>Enables expression profiling and outputs profiler results.</td><td>off</td></tr><tr><td><span class=opa-keep-it-together><code>--profile-sort</code></span></td><td>Criteria to sort the expression profiling results. This options implies <code>--profile</code>.</td><td>total_time_ns =&gt; num_eval =&gt; num_redo =&gt; file =&gt; line</td></tr><tr><td><span class=opa-keep-it-together><code>--profile-limit</code></span></td><td>Desired number of profiling results sorted on the given criteria. This options implies <code>--profile</code>.</td><td>10</td></tr></tbody></table><h3 id=sort-criteria-for-the-profile-results>Sort criteria for the profile results</h3><ul><li><code>total_time_ns</code> - Results are displayed is decreasing order of <em>expression evaluation time</em></li><li><code>num_eval</code> - Results are displayed is decreasing order of <em>number of times an expression is evaluated</em></li><li><code>num_redo</code> - Results are displayed is decreasing order of <em>number of times an expression is re-evaluated(redo)</em></li><li><code>file</code> - Results are sorted in reverse alphabetical order based on the <em>rego source filename</em></li><li><code>line</code> - Results are displayed is decreasing order of <em>expression line number</em> in the source file</li></ul><p>When the sort criteria is not provided <code>total_time_ns</code> has the <strong>highest</strong> priority
while <code>line</code> has the <strong>lowest</strong>.</p><h3 id=example-policy>Example Policy</h3><p>The different profiling examples shown later on this page use the below
sample policy.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#000>package</span> <span style=color:#000>rbac</span>

<span style=color:#8f5902;font-style:italic># Example input request</span>

<span style=color:#000>input</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#4e9a06>&#34;subject&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;bob&#34;</span><span style=color:#000;font-weight:700>,</span>
	<span style=color:#4e9a06>&#34;resource&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;foo123&#34;</span><span style=color:#000;font-weight:700>,</span>
	<span style=color:#4e9a06>&#34;action&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;write&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#8f5902;font-style:italic># Example RBAC configuration.</span>
<span style=color:#000>bindings</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>[</span>
	<span style=color:#000;font-weight:700>{</span>
		<span style=color:#4e9a06>&#34;user&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;alice&#34;</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#4e9a06>&#34;roles&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;dev&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;test&#34;</span><span style=color:#ce5c00;font-weight:700>]</span><span style=color:#000;font-weight:700>,</span>
	<span style=color:#000;font-weight:700>},</span>
	<span style=color:#000;font-weight:700>{</span>
		<span style=color:#4e9a06>&#34;user&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;bob&#34;</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#4e9a06>&#34;roles&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;test&#34;</span><span style=color:#ce5c00;font-weight:700>]</span><span style=color:#000;font-weight:700>,</span>
	<span style=color:#000;font-weight:700>},</span>
<span style=color:#ce5c00;font-weight:700>]</span>

<span style=color:#000>roles</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>[</span>
	<span style=color:#000;font-weight:700>{</span>
		<span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;dev&#34;</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#4e9a06>&#34;permissions&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>[</span>
			<span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;resource&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;foo123&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;action&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;write&#34;</span><span style=color:#000;font-weight:700>},</span>
			<span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;resource&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;foo123&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;action&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;read&#34;</span><span style=color:#000;font-weight:700>},</span>
		<span style=color:#ce5c00;font-weight:700>]</span><span style=color:#000;font-weight:700>,</span>
	<span style=color:#000;font-weight:700>},</span>
	<span style=color:#000;font-weight:700>{</span>
		<span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;test&#34;</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#4e9a06>&#34;permissions&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;resource&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;foo123&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;action&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;read&#34;</span><span style=color:#000;font-weight:700>}</span><span style=color:#ce5c00;font-weight:700>]</span><span style=color:#000;font-weight:700>,</span>
	<span style=color:#000;font-weight:700>},</span>
<span style=color:#ce5c00;font-weight:700>]</span>

<span style=color:#8f5902;font-style:italic># Example RBAC policy implementation.</span>

<span style=color:#000>default</span> <span style=color:#000>allow</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span>

<span style=color:#000>allow</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>user_has_role</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>role_name</span><span style=color:#ce5c00;font-weight:700>]</span>
	<span style=color:#000>role_has_permission</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>role_name</span><span style=color:#ce5c00;font-weight:700>]</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#000>user_has_role</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>role_name</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#204a87>binding</span> <span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>bindings</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>_</span><span style=color:#ce5c00;font-weight:700>]</span>
	<span style=color:#204a87>binding</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>user</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>input</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>subject</span>
	<span style=color:#000>role_name</span> <span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87>binding</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>roles</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>_</span><span style=color:#ce5c00;font-weight:700>]</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#000>role_has_permission</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>role_name</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>role</span> <span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>roles</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>_</span><span style=color:#ce5c00;font-weight:700>]</span>
	<span style=color:#000>role_name</span> <span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>name</span>
	<span style=color:#000>perm</span> <span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>permissions</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>_</span><span style=color:#ce5c00;font-weight:700>]</span>
	<span style=color:#000>perm</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>resource</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>input</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>resource</span>
	<span style=color:#000>perm</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>action</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>input</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>action</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><h3 id=example-display-all-profile-results-with-default-ordering-criteria>Example: Display <code>ALL</code> profile results with <code>default</code> ordering criteria</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>opa <span style=color:#204a87>eval</span> --data rbac.rego --profile --format<span style=color:#ce5c00;font-weight:700>=</span>pretty <span style=color:#4e9a06>&#39;data.rbac.allow&#39;</span></code></pre></div><p><strong>Sample Output</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#204a87;font-weight:700>false</span>

<span style=color:#ce5c00;font-weight:700>+----------+----------+----------+-----------------+</span>
<span style=color:#ce5c00;font-weight:700>|</span>   <span style=color:#000>TIME</span>   <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>NUM</span> <span style=color:#000>EVAL</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>NUM</span> <span style=color:#000>REDO</span> <span style=color:#ce5c00;font-weight:700>|</span>    <span style=color:#000>LOCATION</span>     <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>+----------+----------+----------+-----------------+</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>47</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>148</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>allow</span> <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>965</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>11</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>24</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>384</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>41</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>23</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>064</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>2</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>47</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>15</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>525</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>38</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>14</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>137</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>2</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>46</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>13</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>927</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>0</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>42</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>13</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>568</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>55</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>12</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>982</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>0</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>56</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>12</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>763</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>2</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>52</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>+----------+----------+----------+-----------------+</span>

<span style=color:#ce5c00;font-weight:700>+------------------------------+----------+</span>
<span style=color:#ce5c00;font-weight:700>|</span>            <span style=color:#000>METRIC</span>            <span style=color:#ce5c00;font-weight:700>|</span>  <span style=color:#000>VALUE</span>   <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>+------------------------------+----------+</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>timer_rego_module_compile_ns</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1871613</span>  <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>timer_rego_query_compile_ns</span>  <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>82290</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>timer_rego_query_eval_ns</span>     <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>257952</span>   <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>timer_rego_query_parse_ns</span>    <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>12337169</span> <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>+------------------------------+----------+</span></code></pre></div><p>As seen from the above table, all results are displayed. The profile results are
sorted on the default sort criteria.</p><h4 id=example-display-top-5-profile-results>Example: Display top <code>5</code> profile results</h4><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>opa <span style=color:#204a87>eval</span> --data rbac.rego --profile-limit <span style=color:#0000cf;font-weight:700>5</span> --format<span style=color:#ce5c00;font-weight:700>=</span>pretty <span style=color:#4e9a06>&#39;data.rbac.allow&#39;</span></code></pre></div><p><strong>Sample Output</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#ce5c00;font-weight:700>+----------+----------+----------+-----------------+</span>
<span style=color:#ce5c00;font-weight:700>|</span>   <span style=color:#000>TIME</span>   <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>NUM</span> <span style=color:#000>EVAL</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>NUM</span> <span style=color:#000>REDO</span> <span style=color:#ce5c00;font-weight:700>|</span>    <span style=color:#000>LOCATION</span>     <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>+----------+----------+----------+-----------------+</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>46</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>329</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>allow</span> <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>26</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>656</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>11</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>24</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>206</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>2</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>47</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>23</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>235</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>41</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>18</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>242</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>38</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>+----------+----------+----------+-----------------+</span></code></pre></div><p>The profile results are sorted on the default sort criteria.
Also <code>--profile</code> option is implied and does not need to be provided.</p><h4 id=example-display-top-5-profile-results-based-on-the-number-of-times-an-expression-is-evaluated>Example: Display top <code>5</code> profile results based on the <code>number of times an expression is evaluated</code></h4><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>opa  <span style=color:#204a87>eval</span> --data rbac.rego --profile-limit <span style=color:#0000cf;font-weight:700>5</span> --profile-sort num_eval --format<span style=color:#ce5c00;font-weight:700>=</span>pretty <span style=color:#4e9a06>&#39;data.rbac.allow&#39;</span></code></pre></div><p><strong>Sample Profile Output</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#ce5c00;font-weight:700>+----------+----------+----------+-----------------+</span>
<span style=color:#ce5c00;font-weight:700>|</span>   <span style=color:#000>TIME</span>   <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>NUM</span> <span style=color:#000>EVAL</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>NUM</span> <span style=color:#000>REDO</span> <span style=color:#ce5c00;font-weight:700>|</span>    <span style=color:#000>LOCATION</span>     <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>+----------+----------+----------+-----------------+</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>26</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>675</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>2</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>47</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>9</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>274</span><span style=color:#a40000>µ</span><span style=color:#000>s</span>  <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>2</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>53</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>43</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>356</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>allow</span> <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>22</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>467</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>41</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>22</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>425</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>11</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>+----------+----------+----------+-----------------+</span></code></pre></div><p>As seen from the above table, the results are arranged first in decreasing
order of number of evaluations and if two expressions have been evaluated
the same number of times, the default criteria is used since no other sort criteria is provided.
In this case, total_time_ns =&gt; num_redo =&gt; file =&gt; line.
Also <code>--profile</code> option is implied and does not need to be provided.</p><h4 id=example-display-top-5-profile-results-based-on-the-number-of-times-an-expression-is-evaluated-and-number-of-times-an-expression-is-re-evaluated>Example: Display top <code>5</code> profile results based on the <code>number of times an expression is evaluated</code> and <code>number of times an expression is re-evaluated</code></h4><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>opa <span style=color:#204a87>eval</span> --data rbac.rego --profile-limit <span style=color:#0000cf;font-weight:700>5</span> --profile-sort num_eval,num_redo --format<span style=color:#ce5c00;font-weight:700>=</span>pretty <span style=color:#4e9a06>&#39;data.rbac.allow&#39;</span></code></pre></div><p><strong>Sample Profile Output</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#ce5c00;font-weight:700>+----------+----------+----------+-----------------+</span>
<span style=color:#ce5c00;font-weight:700>|</span>   <span style=color:#000>TIME</span>   <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>NUM</span> <span style=color:#000>EVAL</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>NUM</span> <span style=color:#000>REDO</span> <span style=color:#ce5c00;font-weight:700>|</span>    <span style=color:#000>LOCATION</span>     <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>+----------+----------+----------+-----------------+</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>22</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>892</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>2</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>47</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>831</span><span style=color:#a40000>µ</span><span style=color:#000>s</span>  <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>2</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>53</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>13</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>767</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>2</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>46</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>78</span><span style=color:#a40000>µ</span><span style=color:#000>s</span>  <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>2</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rego</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>52</span>    <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>42</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#0000cf;font-weight:700>338</span><span style=color:#a40000>µ</span><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rbac</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>allow</span> <span style=color:#ce5c00;font-weight:700>|</span>
<span style=color:#ce5c00;font-weight:700>+----------+----------+----------+-----------------+</span></code></pre></div><p>As seen from the above table, result are first arranged based on <em>number of evaluations</em>,
then <em>number of re-evaluations</em> and finally the default criteria is used.
In this case, total_time_ns =&gt; file =&gt; line.
The <code>--profile-sort</code> options accepts repeated or comma-separated values for the criteria.
The order of the criteria on the command line determine their priority.</p><p>Another way to get the same output as above would be the following:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>opa <span style=color:#204a87>eval</span> --data rbac.rego --profile-limit <span style=color:#0000cf;font-weight:700>5</span> --profile-sort num_eval --profile-sort num_redo --format<span style=color:#ce5c00;font-weight:700>=</span>pretty <span style=color:#4e9a06>&#39;data.rbac.allow&#39;</span></code></pre></div></div></section></div></article></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js></script><script src=/js/app.145c7a3bc61d0b561cc282851776ffdcd33e6b35aebca1b05449aa9195eaf751.js integrity="sha256-FFx6O8YdC1YcwoKFF3b/3NM&#43;azWuvKGwVEmqkZXq91E="></script></body></html>